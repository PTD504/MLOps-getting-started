# Thu thập logs từ Docker containers
<source>
  @type forward
  port 24224
  bind 0.0.0.0
</source>

# Thu thập syslog từ system
<source>
  @type syslog
  port 5140
  bind 0.0.0.0
  tag system.syslog
</source>

# Thu thập logs từ file
<source>
  @type tail
  path /app/logs/*.log
  pos_file /var/log/fluentd/app.log.pos
  tag app.logs
  format json
  time_key timestamp
  keep_time_key true
</source>

# Thu thập stdout/stderr từ containers
<source>
  @type tail
  path /var/lib/docker/containers/*/*.log
  pos_file /var/log/fluentd/docker.log.pos
  tag docker.*
  format json
  time_key time
</source>

# Filter để parse Docker logs
<filter docker.**>
  @type parser
  key_name log
  reserve_data true
  <parse>
    @type json
  </parse>
</filter>

# Output tất cả logs ra stdout để debug
<match **>
  @type copy
  
  # Ghi ra console
  <store>
    @type stdout
  </store>
  
  # Ghi vào file để persistent storage
  <store>
    @type file
    path /fluentd/log/aggregated
    time_slice_format %Y%m%d%H
    time_slice_wait 10m
    time_format %Y%m%dT%H%M%S%z
    compress gzip
    utc
  </store>
  
  # Forward tới Elasticsearch (optional)
  # <store>
  #   @type elasticsearch
  #   host elasticsearch
  #   port 9200
  #   index_name mlops-logs
  #   type_name _doc
  # </store>
</match>